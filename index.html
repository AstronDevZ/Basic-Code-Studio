<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic Code Studio</title>
    
    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/material-darker.min.css">
    
    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Estilos Personalizados -->
    <style>
        /* Reset básico */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1e1e2f;
            color: #ffffff;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* Barra de Título */
        .title-bar {
            display: flex;
            align-items: center;
            background-color: #252532;
            padding: 10px 20px;
            height: 50px;
            flex-shrink: 0;
            justify-content: space-between;
        }

        .title-bar .menu {
            display: flex;
            gap: 15px;
        }

        .title-bar .menu a {
            color: #d0d0e1;
            text-decoration: none;
            font-size: 0.9rem;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .title-bar .menu a:hover {
            background-color: #3c3c4e;
        }

        /* Botões da Barra de Ferramentas */
        .toolbar {
            display: flex;
            gap: 10px;
        }

        .toolbar button {
            background: none;
            border: none;
            color: #d0d0e1;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .toolbar button:hover {
            background-color: #3c3c4e;
        }

        /* Container Principal */
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: #2e2e40;
            padding: 15px;
            overflow-y: auto;
            flex-shrink: 0;
            transition: transform 0.3s ease-in-out;
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        .sidebar h2 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #ff6f61;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar ul li {
            padding: 8px 10px;
            margin-bottom: 5px;
            background-color: #3a3a52;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .sidebar ul li:hover {
            background-color: #4a4a65;
        }

        .sidebar ul li .file-name {
            flex: 1;
        }

        .sidebar ul li .file-actions {
            display: flex;
            gap: 5px;
        }

        .sidebar ul li .file-actions i {
            font-size: 0.8rem;
            cursor: pointer;
            color: #a0a0b2;
            transition: color 0.3s;
        }

        .sidebar ul li .file-actions i:hover {
            color: #ff6f61;
        }

        /* Editor Container */
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #1e1e2f;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background-color: #2e2e40;
            padding: 5px 10px;
            overflow-x: auto;
        }

        .tabs .tab {
            padding: 8px 12px;
            margin-right: 5px;
            background-color: #3a3a52;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: center;
        }

        .tabs .tab.active {
            background-color: #1e1e2f;
            border-bottom: 2px solid #ff6f61;
        }

        .tabs .tab .close-btn {
            margin-left: 8px;
            font-size: 0.8rem;
            color: #a0a0b2;
            cursor: pointer;
        }

        .tabs .tab .close-btn:hover {
            color: #ff6f61;
        }

        /* CodeMirror Editor */
        .editor {
            flex: 1;
        }

        /* Barra de Status */
        .status-bar {
            background-color: #252532;
            padding: 5px 10px;
            height: 30px;
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: #a0a0b2;
        }

        /* Live Preview */
        .preview-container {
            width: 300px;
            background-color: #2e2e40;
            border-left: 1px solid #3a3a52;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .preview-header {
            background-color: #3a3a52;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        .preview-content {
            flex: 1;
            background-color: #ffffff;
        }

        /* Responsividade */
        @media (max-width: 1024px) {
            .preview-container {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: absolute;
                height: 100%;
                z-index: 1000;
            }

            .sidebar.hidden {
                transform: translateX(-100%);
            }

            .preview-container {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Barra de Título -->
    <div class="title-bar">
        <div class="menu">
            <a href="#"><i class="fas fa-file"></i> Arquivo</a>
            <a href="#"><i class="fas fa-edit"></i> Editar</a>
            <a href="#"><i class="fas fa-view"></i> Visualizar</a>
            <a href="#"><i class="fas fa-play"></i> Executar</a>
            <a href="#"><i class="fas fa-question-circle"></i> Ajuda</a>
        </div>
        <div class="toolbar">
            <button id="toggle-sidebar" title="Mostrar/Ocultar Sidebar"><i class="fas fa-bars"></i></button>
            <button id="new-file" title="Novo Arquivo"><i class="fas fa-file-circle-plus"></i></button>
            <button id="save-file" title="Salvar Arquivo"><i class="fas fa-floppy-disk"></i></button>
            <button id="toggle-theme" title="Alternar Tema"><i class="fas fa-adjust"></i></button>
        </div>
    </div>

    <!-- Container Principal -->
    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <h2>Explorador de Arquivos <i class="fas fa-plus-circle" id="add-file-btn" title="Adicionar Arquivo"></i></h2>
            <ul id="file-list">
                <!-- Arquivos serão adicionados dinamicamente aqui -->
            </ul>
        </div>

        <!-- Editor Container -->
        <div class="editor-container">
            <!-- Tabs -->
            <div class="tabs" id="tabs">
                <!-- Abas serão adicionadas dinamicamente aqui -->
            </div>

            <!-- CodeMirror Editor -->
            <div class="editor" id="editor"></div>

            <!-- Barra de Status -->
            <div class="status-bar">
                <div id="file-info">Nenhum arquivo aberto</div>
                <div id="cursor-position">Linha 0, Coluna 0</div>
            </div>
        </div>

        <!-- Live Preview -->
        <div class="preview-container" id="preview">
            <div class="preview-header">Live Preview</div>
            <iframe class="preview-content" id="preview-frame" sandbox="allow-scripts"></iframe>
        </div>
    </div>

    <!-- CodeMirror JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
    <!-- CodeMirror Mode Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/markdown/markdown.min.js"></script>
    <!-- CodeMirror Addons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/display/placeholder.min.js"></script>

    <!-- Script Personalizado -->
    <script>
        // Inicializar CodeMirror
        const editorElement = document.getElementById('editor');
        let editor = CodeMirror(editorElement, {
            value: "",
            mode: "javascript",
            theme: "material-darker",
            lineNumbers: true,
            lineWrapping: true,
            autofocus: true,
            autoCloseBrackets: true,
            placeholder: "Escreva seu código aqui..."
        });

        // Elementos do DOM
        const fileList = document.getElementById('file-list');
        const tabsContainer = document.getElementById('tabs');
        const fileInfo = document.getElementById('file-info');
        const cursorPosition = document.getElementById('cursor-position');
        const addFileBtn = document.getElementById('add-file-btn');
        const toggleSidebarBtn = document.getElementById('toggle-sidebar');
        const newFileBtn = document.getElementById('new-file');
        const saveFileBtn = document.getElementById('save-file');
        const toggleThemeBtn = document.getElementById('toggle-theme');
        const previewFrame = document.getElementById('preview-frame');
        const previewContainer = document.getElementById('preview');

        let files = {}; // Objeto para armazenar arquivos
        let activeFile = null;
        let themeDark = true;

        // Função para salvar arquivos no localStorage
        function saveToLocal() {
            localStorage.setItem('basicCodeStudioFiles', JSON.stringify(files));
        }

        // Função para carregar arquivos do localStorage
        function loadFromLocal() {
            const storedFiles = localStorage.getItem('basicCodeStudioFiles');
            if (storedFiles) {
                files = JSON.parse(storedFiles);
                for (let filename in files) {
                    addFileToList(filename);
                }
            } else {
                // Arquivos padrão
                files = {
                    'index.html': '<!-- Escreva seu HTML aqui -->',
                    'styles.css': '/* Escreva seu CSS aqui */',
                    'script.js': '// Escreva seu JavaScript aqui',
                    'README.md': '# README\nEscreva sua documentação aqui.'
                };
                for (let filename in files) {
                    addFileToList(filename);
                }
                saveToLocal();
            }
        }

        // Função para adicionar arquivo à sidebar
        function addFileToList(filename) {
            const li = document.createElement('li');
            li.innerHTML = `<span class="file-name">${filename}</span>
                           <span class="file-actions">
                               <i class="fas fa-pen rename-file" title="Renomear"></i>
                               <i class="fas fa-trash delete-file" title="Excluir"></i>
                           </span>`;
            fileList.appendChild(li);
        }

        // Função para criar nova aba
        function createTab(filename) {
            // Verificar se a aba já está aberta
            const existingTab = Array.from(tabsContainer.children).find(tab => tab.dataset.file === filename);
            if (existingTab) {
                setActiveTab(existingTab);
                return;
            }

            const tab = document.createElement('div');
            tab.classList.add('tab');
            tab.dataset.file = filename;
            tab.innerHTML = `${filename}<span class="close-btn">&times;</span>`;
            tabsContainer.appendChild(tab);
            setActiveTab(tab);
        }

        // Função para definir aba ativa
        function setActiveTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            activeFile = tab.dataset.file;
            fileInfo.textContent = activeFile;
            editor.setValue(files[activeFile] || '');
            setEditorMode(activeFile);
            updatePreview();
        }

        // Função para definir o modo do CodeMirror baseado na extensão do arquivo
        function setEditorMode(filename) {
            const extension = filename.split('.').pop();
            let mode = 'javascript';
            switch(extension) {
                case 'html':
                    mode = 'htmlmixed';
                    break;
                case 'css':
                    mode = 'css';
                    break;
                case 'js':
                    mode = 'javascript';
                    break;
                case 'md':
                    mode = 'markdown';
                    break;
                default:
                    mode = 'javascript';
            }
            editor.setOption('mode', mode);
        }

        // Função para atualizar o preview
        function updatePreview() {
            if (!activeFile || !activeFile.endsWith('.html')) {
                previewFrame.srcdoc = '';
                return;
            }
            const htmlContent = files[activeFile] || '';
            previewFrame.srcdoc = htmlContent;
        }

        // Event Listener para mudanças no editor
        editor.on('change', () => {
            if (activeFile) {
                files[activeFile] = editor.getValue();
                saveToLocal();
                updatePreview();
            }
        });

        // Event Listener para atualização da posição do cursor
        editor.on('cursorActivity', () => {
            const cursor = editor.getCursor();
            cursorPosition.textContent = `Linha ${cursor.line + 1}, Coluna ${cursor.ch + 1}`;
        });

        // Event Listener para clicar nos arquivos da sidebar
        fileList.addEventListener('click', (e) => {
            const li = e.target.closest('li');
            if (!li) return;
            const filename = li.querySelector('.file-name').textContent;
            createTab(filename);
        });

        // Event Listener para ações nos arquivos (renomear e excluir)
        fileList.addEventListener('click', (e) => {
            const li = e.target.closest('li');
            if (!li) return;
            const filename = li.querySelector('.file-name').textContent;

            if (e.target.classList.contains('rename-file')) {
                const newName = prompt('Renomear arquivo:', filename);
                if (newName && !files[newName]) {
                    files[newName] = files[filename];
                    delete files[filename];
                    saveToLocal();
                    li.querySelector('.file-name').textContent = newName;
                    // Atualizar abas
                    const tab = Array.from(tabsContainer.children).find(t => t.dataset.file === filename);
                    if (tab) {
                        tab.dataset.file = newName;
                        tab.firstChild.textContent = newName;
                        if (activeFile === filename) {
                            setActiveTab(tab);
                        }
                    }
                } else if (files[newName]) {
                    alert('Já existe um arquivo com esse nome.');
                }
            }

            if (e.target.classList.contains('delete-file')) {
                if (confirm(`Tem certeza que deseja excluir "${filename}"?`)) {
                    delete files[filename];
                    saveToLocal();
                    li.remove();
                    // Fechar aba se estiver aberta
                    const tab = Array.from(tabsContainer.children).find(t => t.dataset.file === filename);
                    if (tab) {
                        if (tab.classList.contains('active')) {
                            tab.remove();
                            const remainingTabs = tabsContainer.querySelectorAll('.tab');
                            if (remainingTabs.length > 0) {
                                setActiveTab(remainingTabs[0]);
                            } else {
                                activeFile = null;
                                fileInfo.textContent = 'Nenhum arquivo aberto';
                                editor.setValue('');
                                previewFrame.srcdoc = '';
                            }
                        } else {
                            tab.remove();
                        }
                    }
                }
            }
        });

        // Event Listener para fechar abas
        tabsContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('close-btn')) {
                const tab = e.target.parentElement;
                const filename = tab.dataset.file;
                tab.remove();
                // Fechar arquivo ativo
                if (tab.classList.contains('active')) {
                    const remainingTabs = tabsContainer.querySelectorAll('.tab');
                    if (remainingTabs.length > 0) {
                        setActiveTab(remainingTabs[0]);
                    } else {
                        activeFile = null;
                        fileInfo.textContent = 'Nenhum arquivo aberto';
                        editor.setValue('');
                        previewFrame.srcdoc = '';
                    }
                }
            } else if (e.target.classList.contains('tab') || e.target.closest('.tab')) {
                const tab = e.target.closest('.tab');
                if (tab && !tab.classList.contains('active')) {
                    setActiveTab(tab);
                }
            }
        });

        // Função para adicionar novo arquivo
        function addNewFile() {
            const filename = prompt('Nome do novo arquivo (ex: script.js):');
            if (filename && !files[filename]) {
                files[filename] = '';
                addFileToList(filename);
                saveToLocal();
                createTab(filename);
            } else if (files[filename]) {
                alert('Já existe um arquivo com esse nome.');
            }
        }

        // Event Listener para adicionar arquivo via botão
        addFileBtn.addEventListener('click', addNewFile);
        newFileBtn.addEventListener('click', addNewFile);

        // Função para salvar arquivo (já salvo automaticamente, mas pode forçar)
        function saveFile() {
            if (activeFile) {
                files[activeFile] = editor.getValue();
                saveToLocal();
                alert(`Arquivo "${activeFile}" salvo com sucesso!`);
            } else {
                alert('Nenhum arquivo aberto para salvar.');
            }
        }

        saveFileBtn.addEventListener('click', saveFile);

        // Função para alternar tema
        function toggleTheme() {
            themeDark = !themeDark;
            if (themeDark) {
                editor.setOption('theme', 'material-darker');
                document.body.style.backgroundColor = '#1e1e2f';
                document.querySelector('.title-bar').style.backgroundColor = '#252532';
                document.querySelector('.toolbar').style.color = '#d0d0e1';
            } else {
                editor.setOption('theme', 'default');
                document.body.style.backgroundColor = '#f5f5f5';
                document.querySelector('.title-bar').style.backgroundColor = '#ffffff';
                document.querySelector('.toolbar').style.color = '#333333';
            }
        }

        toggleThemeBtn.addEventListener('click', toggleTheme);

        // Função para alternar a visibilidade da sidebar
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('hidden');
        }

        toggleSidebarBtn.addEventListener('click', toggleSidebar);

        // Função para inicializar o Live Preview
        function initializePreview() {
            if (!activeFile || !activeFile.endsWith('.html')) {
                previewFrame.srcdoc = '';
                return;
            }
            const htmlContent = files[activeFile] || '';
            previewFrame.srcdoc = htmlContent;
        }

        // Atualizar o preview quando o conteúdo muda
        editor.on('change', initializePreview);

        // Carregar arquivos do localStorage ao iniciar
        loadFromLocal();

        // Abrir a primeira aba automaticamente se houver arquivos
        window.onload = () => {
            const firstFile = Object.keys(files)[0];
            if (firstFile) {
                createTab(firstFile);
            }
        };
    </script>
</body>
</html>
